 {% extends "base_bootstrap.html" %}  
{% block content %}     

<style>
    #scanner_form{ 
        width:60%;
    } 
    #scanner_button{ 
        color: #fff; 
        background-color: blueviolet; 
        margin-top:5%;   
    } 
    #scanner_button:hover{ 
        background-color: rgb(242, 238, 247);
        transition: background-color 0.2s;   
        color: #454545;  
        border-color: rgb(242, 238, 247);
    }  
    .my-type{
        padding:5% 0; 
    }  
    .form-control{   
        margin-bottom:5%;  
        margin-top:2%; 
    } 
    .form-check{ 
        margin:5px 0;   
    }
</style> 
<br />
<div id="spinner"></div> 
<div class="form-control" style="box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.24); padding:2em;background-color: rgb(242, 238, 247);"> 
<p>
    {% load crispy_forms_tags %}
    <form method="post" action="{% url 'post_form_scanner' %}" id="scanner_form" >
        {% csrf_token %}
        {{ scanner_form|crispy }}
        <input type="submit" value="Шалгах" class="btn" id="scanner_button">
    </form>
</p>
<p>
    <a href="{% url 'scanner_type' 'QS' %}">Хуран шалгалтын хариуг харах</a>
</p>
<p>
    <a href="{% url 'scanner_type' 'FS' %}">Бүрэн шалгалтын хариуг харах</a>
</p> 
</div>
<!--https://stackoverflow.com/questions/1960240/jquery-ajax-submit-form-->
<!--https://django-crispy-forms.readthedocs.io/en/latest/crispy_tag_forms.html#ajax-validation-recipe-->
<script type="text/javascript">
    $( document ).ready(function() {
      $('#scanner_button').click(function (event) {
        event.preventDefault();
        var scanner_form = '#scanner_form';

        $.ajax({
            url: "{% url 'post_form_scanner' %}",
            type: "POST",
            data: $(scanner_form).serialize(),
            datatype: 'json',
            header: {'X-CSRFToken': '{% csrf_token %}'},
            beforeSend: function () {
                // Set spinner from https://getbootstrap.com/docs/4.4/components/spinners/
                $('#spinner').html('<div class="d-flex align-items-center"><strong>Scanning, please wait, this will take a while...</strong><div class="spinner-border ml-auto" role="status" aria-hidden="true" style="width: 3rem; height: 3rem;"></div></div>')
            },
            success: function(data) {
                if (!(data['success'])) {
                    // Here we replace the form, for the
                    alert("An error has occurred");
                }
                else {
                    // Here you can show the user a success message or do whatever you need
                    alert("The network has been scanned successfully");
                }
            },
            complete: function () {
                $('#spinner').empty(); //Remove child elements
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(xhr.responseText);
            }
        });
      });
     });
  </script>
{% endblock %}